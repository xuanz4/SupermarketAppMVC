<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Supermarket App | Shop</title>
</head>
<body class="bg-surface">
        <nav class="topbar shadow-sm">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-3">
        <a class="brand-mark" href="/">SM</a>
        <span class="fw-semibold">Supermarket</span>
      </div>
      <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end">
        <% if (user && user.role !== "admin") { %>
          <a class="nav-chip" href="/orders/history">Orders</a>
        <% } %>
        <% if (user && user.role === "admin") { %>
          <a class="nav-chip" href="/inventory">Inventory</a>
          <a class="nav-chip" href="/admin/users">Users</a>
          <a class="nav-chip" href="/admin/deliveries">Deliveries</a>
        <% } %>
        <a class="btn btn-primary" href="/logout">Logout</a>
      </div>
    </div>
  </nav>

  <% const activeHero = (products && products.length) ? products[0] : null; %>

  <header class="hero-banner-alt">
    <div class="container d-flex flex-column flex-lg-row align-items-lg-end gap-4">
      <div class="flex-grow-1">
        <p class="text-uppercase small text-muted mb-2">Curated for you</p>
        <h1 class="fw-bold text-navy mb-3">Fresh groceries, concierge style.</h1>
        <p class="text-muted mb-4">Handpicked deals, clean layout, and a calmer way to shop.</p>
        <div class="d-flex flex-wrap gap-2">
          <a href="/cart" class="btn btn-primary">View cart</a>
          <a href="<%= activeHero ? '/product/' + activeHero.id : '#' %>" class="btn btn-outline-dark <%= activeHero ? '' : 'disabled' %>">Featured</a>
        </div>
      </div>
      <div class="hero-card-compact">
        <div>
          <p class="small text-muted mb-1">Live products</p>
          <h3 class="fw-bold mb-0"><%= products ? products.length : 0 %></h3>
        </div>
        <div>
          <p class="small text-muted mb-1">Categories</p>
          <h3 class="fw-bold mb-0"><%= (categories || []).length %></h3>
        </div>
        <div>
          <p class="small text-muted mb-1">Highlight</p>
          <span class="pill-soft"><%= activeHero ? activeHero.productName : 'TBD' %></span>
        </div>
      </div>
    </div>
  </header>

  <main class="page-section">
    <div class="container">
      <div class="layout-grid">
        <aside class="filter-panel shadow-sm">
          <form action="/shopping" method="GET" class="d-flex flex-column gap-3">
            <div>
              <label class="form-label small text-muted text-uppercase">Search</label>
              <input type="text" class="form-control" name="search" placeholder="Search products" value="<%= searchTerm || '' %>">
            </div>
            <div>
              <label class="form-label small text-muted text-uppercase">Category</label>
              <select name="category" class="form-select">
                <option value="">All</option>
                <% (categories || []).forEach(function(cat) { %>
                  <option value="<%= cat %>" <%= activeCategory === cat ? 'selected' : '' %>><%= cat %></option>
                <% }); %>
              </select>
            </div>
            <div>
              <label class="form-label small text-muted text-uppercase">Sort</label>
              <select name="sort" class="form-select">
                <option value="">Name (A-Z)</option>
                <option value="price_asc" <%= sort === 'price_asc' ? 'selected' : '' %>>Price: Low to High</option>
                <option value="price_desc" <%= sort === 'price_desc' ? 'selected' : '' %>>Price: High to Low</option>
                <option value="discount_desc" <%= sort === 'discount_desc' ? 'selected' : '' %>>Biggest discount</option>
                <option value="newest" <%= sort === 'newest' ? 'selected' : '' %>>Newest first</option>
              </select>
            </div>
            <div class="row g-2">
              <div class="col">
                <label class="form-label small text-muted text-uppercase">Min price</label>
                <input type="number" step="0.01" min="0" class="form-control" name="minPrice" value="<%= minPrice || '' %>">
              </div>
              <div class="col">
                <label class="form-label small text-muted text-uppercase">Max price</label>
                <input type="number" step="0.01" min="0" class="form-control" name="maxPrice" value="<%= maxPrice || '' %>">
              </div>
            </div>
            <button type="submit" class="btn btn-primary w-100">Apply</button>
            <a href="/shopping" class="btn btn-soft w-100">Reset</a>
          </form>
        </aside>

        <section class="content-panel">
          <% if (messages && messages.length) { %>
            <% messages.forEach(function(message) { %>
              <div class="alert alert-success mb-3"><%= message %></div>
            <% }); %>
          <% } %>

          <% if (errors && errors.length) { %>
            <% errors.forEach(function(error) { %>
              <div class="alert alert-danger mb-3"><%= error %></div>
            <% }); %>
          <% } %>

          <% if (bestSellers && bestSellers.length) { %>
            <div class="card border-0 shadow-sm mb-4">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h5 class="mb-0 text-navy">Bestsellers</h5>
                  <span class="pill-soft">Most loved</span>
                </div>
                <div class="row g-3">
                  <% bestSellers.forEach(function(item) { %>
                    <div class="col-12 col-md-4 col-xl-3">
                      <div class="card h-100 product-card">
                        <% if (item.image) { %>
                          <img src="/images/<%= item.image %>" class="card-img-top" alt="<%= item.productName %>">
                        <% } else { %>
                          <div class="card-img-top placeholder-img">No image</div>
                        <% } %>
                        <div class="card-body">
                          <h6 class="mb-1"><a class="link-dark text-decoration-none" href="/product/<%= item.id %>"><%= item.productName %></a></h6>
                          <p class="small text-muted mb-2">Sold <%= item.totalSold %></p>
                          <div class="d-flex flex-wrap gap-2 align-items-center">
                            <% if (item.hasDiscount) { %>
                              <span class="price-chip"><span class="muted">$<%= Number(item.price).toFixed(2) %></span> $<%= Number(item.effectivePrice).toFixed(2) %></span>
                              <span class="deal-flag">Save <%= Number(item.discountPercentage).toFixed(0) %>%</span>
                            <% } else { %>
                              <span class="price-chip">$<%= Number(item.price).toFixed(2) %></span>
                            <% } %>
                          </div>
                        </div>
                      </div>
                    </div>
                  <% }); %>
                </div>
              </div>
            </div>
          <% } %>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0 text-navy">All products</h5>
            <span class="pill-soft"><%= products ? products.length : 0 %> items</span>
          </div>

          <div class="row g-3">
            <% if (products && products.length) { %>
              <% products.forEach(function(product) { %>
                <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                  <div class="card h-100 product-card">
                    <% if (product.image) { %>
                      <img src="/images/<%= product.image %>" class="card-img-top" alt="<%= product.productName %>">
                    <% } else { %>
                      <div class="card-img-top placeholder-img">Pending photo</div>
                    <% } %>
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                          <h6 class="card-title mb-1"><a href="/product/<%= product.id %>" class="link-dark text-decoration-none"><%= product.productName %></a></h6>
                          <span class="badge bg-light text-dark"><%= product.category || 'General' %></span>
                        </div>
                        <span class="badge <%= product.quantity > 5 ? 'bg-success-subtle text-success' : 'bg-warning-subtle text-warning' %>">Stock <%= product.quantity %></span>
                      </div>

                      <div class="d-flex flex-column gap-1 mb-3">
                        <% if (product.hasDiscount) { %>
                          <span class="price-chip"><span class="muted">$<%= Number(product.price).toFixed(2) %></span> $<%= Number(product.effectivePrice).toFixed(2) %></span>
                          <span class="deal-flag">Save <%= Number(product.discountPercentage).toFixed(0) %>%</span>
                        <% } else { %>
                          <span class="price-chip">$<%= Number(product.price).toFixed(2) %></span>
                        <% } %>
                      </div>

                      <% if (product.offerMessage) { %>
                        <div class="alert alert-info py-2 mb-3">
                          <span class="fw-semibold text-uppercase small">Offer</span>
                          <div class="small mb-0"><%= product.offerMessage %></div>
                        </div>
                      <% } %>

                      <% if (product.quantity > 0) { %>
                        <form action="/add-to-cart/<%= product.id %>" method="POST" class="mt-auto">
                          <label for="quantity-<%= product.id %>" class="form-label small text-muted text-uppercase">Qty</label>
                          <div class="input-group">
                            <select id="quantity-<%= product.id %>" name="quantity" class="form-select">
                              <% const maxQty = Math.min(product.quantity, 10); %>
                              <% for (let q = 1; q <= maxQty; q++) { %>
                                <option value="<%= q %>"><%= q %></option>
                              <% } %>
                            </select>
                            <button type="submit" class="btn btn-primary">Add</button>
                          </div>
                        </form>
                      <% } else { %>
                        <div class="alert alert-warning mt-auto mb-0">Out of stock - we will restock soon.</div>
                      <% } %>
                    </div>
                  </div>
                </div>
              <% }); %>
            <% } else { %>
              <div class="col-12">
                <div class="empty-state">
                  <h3>No products match your filters</h3>
                  <p class="text-muted mb-0">Try resetting search or category to see more items.</p>
                  <a href="/shopping" class="btn btn-primary mt-3">Reset filters</a>
                </div>
              </div>
            <% } %>
          </div>
        </section>
      </div>
    </div>
  </main>
</body>
</html>





